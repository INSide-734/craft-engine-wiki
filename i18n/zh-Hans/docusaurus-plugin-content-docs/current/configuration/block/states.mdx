---
title: 🔣 方块状态
id: states
---

## 简介

在 Minecraft 的方块系统中，每个方块都带有一个或多个方块状态。例如，木头有朝向，树叶有不同的距离。这些方块状态决定了方块在游戏中的行为和外观。

首先我需要向你介绍两个概念：**视觉方块状态** 和 **内部方块状态**

**视觉方块状态**，又称为原版方块状态，是指玩家客户端收到的方块状态。比如具有特定音调和音色的音符盒，插件通过为这些状态添加模型以实现自定义方块渲染。

**内部方块状态**，又称为服务端侧方块状态、真实方块状态，是服务端上真正被存储，执行物理行为的方块状态，通过网络协议转换为视觉方块状态发送给客户端渲染。


![](/img/block_states_1.png)

## 单状态方块

大多数方块仅需一个方块状态即可正常运行。以下示例展示了如何配置单状态方块。

```yaml
blocks:
  default:chinese_lantern:
    state:
      auto-state: note_block
      model:
        path: "minecraft:block/custom/chinese_lantern"
        generation:
          parent: "minecraft:block/cube_column"
          textures:
            "end": "minecraft:block/custom/chinese_lantern_top"
            "side": "minecraft:block/custom/chinese_lantern"
```

### 模型

```yaml
blocks:
  default:chinese_lantern:
    state:
      model:
        path: "minecraft:block/custom/chinese_lantern"
        generation:
          parent: "minecraft:block/cube_column"
          textures:
            "end": "minecraft:block/custom/chinese_lantern_top"
            "side": "minecraft:block/custom/chinese_lantern"
```

`model` 决定了哪个 3D 模型将替换被释放的原版方块状态。除了标准的方块模型外，CraftEngine 还允许进一步配置随机模型和模型旋转。

:::caution

如果你不确定如何配置 `path` 和 `generation` 等属性，你应该首先完成[教程](../../getting_start.mdx)。

:::

#### 加权模型

要实现随机模型，只需以列表格式提供模型路径即可：

```yaml
state:
  models: # model(s)
    - path: "minecraft:block/custom/fairy_flower_1"
      weight: 8
    - path: "minecraft:block/custom/fairy_flower_2"
      weight: 5
    - path: "minecraft:block/custom/fairy_flower_3"
      weight: 2
```

> weight：设置模型在游戏中被选用的权重。默认为1（即100%）。如果候选模型指定了一个模型选择列表，游戏会根据方块所在的位置计算应该选择什么模型，如果方块位置一致选择的模型也就一致。模型列表内一个模型被选中的概率由weight决定：假设第一个模型的weight为w1，第二个模型的weight为w2，以此类推直到第n个模型，那么总权重为W=w1+w2+w3+...+wn，选中第n个模型的概率就是wn/W。举例来说，如果第一个模型权重为1，第二个模型权重为2，第三个模型权重为1，则选中第一个模型的概率为25%，选中第二个模型的概率为50%，选中第三个模型的概率为25%。

![](/img/block_states_4.png)

#### 旋转

如果你需要创建一块具有三种不同方向的木头，你只需指定 x 和 y 属性即可。

```yaml
model:
  path: "minecraft:block/custom/chinese_lantern"
  x: 90
  y: 180
  uvlock: false
```

> x: 模型相对于X轴的旋转，单位为度，必须为90的倍数。\
> y: 模型相对于Y轴的旋转，单位为度，必须为90的倍数。\
> uvlock: 是否锁定方块纹理的旋转方向，默认为false。如果设置为 true，则锁定方块材质的旋转。这样，使用上面的 x 和 y 属性时，材质不会随方块旋转。

## 多状态方块

:::warning

接下来的内容可能会比较难懂。我会尽可能详细地解释，请务必**逐字逐句**仔细阅读。

:::

创建多状态方块的第一步是为该方块定义状态**属性**的类型。在此示例中，我设置了一个 `axis` 属性。

```yaml
blocks:
  default:palm_log:
    states: # state(s)
      properties:
        axis:             # 属性名称
          type: axis      # 数据类型
          default: y      # 默认值
```

### 属性

属性名称几乎可以随意选择，但我建议使用小写字母。不过，插件会为特殊的放置行为硬编码某些名称。例如，当属性名为 `axis` 时，插件在放置时会自动对齐其方向。这一过程是完全自动化的。

在下面的示例中，由于属性名为 `custom_axis`，插件在放置时不会应用旋转。无论你如何放置，方块在放置时将始终使用 `custom_axis=y` 状态。

```yaml
custom_axis:
  type: axis
  default: y 
```

:::tip

您可以在[ℹ️ 属性](states/properties.mdx)中找到有关属性类型和插件硬编码属性名称的详细信息。

:::

### 外观

在第二步中，我们需要配置自定义方块的可能视觉外观。例如，一个木头方块需要三种方向，因此我们需要指定三种原版方块状态作为其视觉表现。

```yaml
blocks:
  default:palm_log:
    states:
      appearances:
        axisY:
          state: "note_block:0"
          model:
            path: "minecraft:block/custom/stripped_palm_log"
            generation:
              parent: "minecraft:block/cube_column"
              textures:
                "end": "minecraft:block/custom/palm_log_top"
                "side": "minecraft:block/custom/palm_log"
        axisX:
          state: "note_block:1"
          model:
            x: 90
            y: 90
            path: "minecraft:block/custom/stripped_palm_log_horizontal"
            generation:
              parent: "minecraft:block/cube_column_horizontal"
              textures:
                "end": "minecraft:block/custom/palm_log_top"
                "side": "minecraft:block/custom/palm_log"
        axisZ:
          state: "note_block:2"
          model:
            x: 90
            path: "minecraft:block/custom/stripped_palm_log_horizontal"
            generation:
              parent: "minecraft:block/cube_column_horizontal"
              textures:
                "end": "minecraft:block/custom/palm_log_top"
                "side": "minecraft:block/custom/palm_log"
```

:::info

在上述配置中，`axisX`、`axisZ` 和 `axisY` 可以任意名称。您可以使用任何能清晰表示视觉状态的描述性术语，只要它们是唯一的即可。

`state` 和 `model(s)` 的配置遵循与单状态方块相同的规则。如果您对任何细节不确定，请参阅相关文档。

:::

### 变体

在最后一步中，我们需要组合所有自定义属性，列出所有可能的组合，并为每个组合分配内部方块标识符。如果您不熟悉 **内部标识符**，请参阅相关文档。

对于属性及其值，使用 `=` 连接它们（例如，`axis=y`）。当多个属性一起出现时，用逗号分隔（例如，`axis=y,age=7`）。

```yaml
blocks:
  default:palm_log:
    states:
      variants:
        axis=x:
          appearance: axisX # 指的是我们在“appearances”中刚刚定义的外观名称。
        axis=y:
          appearance: axisY
        axis=z:
          appearance: axisZ
```

<details>
  <summary>完整配置</summary>

```yml
blocks:
  default:palm_log:
    states:
      properties:
        axis:
          type: axis
          default: y
      appearances:
        axisY:
          state: "note_block:0"
          model:
            path: "minecraft:block/custom/stripped_palm_log"
            generation:
              parent: "minecraft:block/cube_column"
              textures:
                "end": "minecraft:block/custom/palm_log_top"
                "side": "minecraft:block/custom/palm_log"
        axisX:
          state: "note_block:1"
          model:
            x: 90
            y: 90
            path: "minecraft:block/custom/stripped_palm_log_horizontal"
            generation:
              parent: "minecraft:block/cube_column_horizontal"
              textures:
                "end": "minecraft:block/custom/palm_log_top"
                "side": "minecraft:block/custom/palm_log"
        axisZ:
          state: "note_block:2"
          model:
            x: 90
            path: "minecraft:block/custom/stripped_palm_log_horizontal"
            generation:
              parent: "minecraft:block/cube_column_horizontal"
              textures:
                "end": "minecraft:block/custom/palm_log_top"
                "side": "minecraft:block/custom/palm_log"
      variants:
        axis=x:
          appearance: axisX
        axis=y:
          appearance: axisY
        axis=z:
          appearance: axisZ
```

</details>

:::tip

要为特定状态自定义方块设置，请添加如下配置：

```yaml
variants:
  "distance=7,persistent=false,waterlogged=false":
    appearance: "default"
    settings:
      is-randomly-ticking: true
```

:::